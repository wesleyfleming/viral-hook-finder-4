name: Update Viral Hooks Daily

on:
  schedule:
    - cron: '0 9 * * *'
  workflow_dispatch:

jobs:
  update-hooks:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install requests openai yt-dlp pandas schedule python-dotenv beautifulsoup4
      
      - name: Run hook finder for multiple niches
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          echo "Searching for viral hooks..."
          python3 demo_hook_finder.py fitness
          python3 demo_hook_finder.py marketing
          python3 demo_hook_finder.py "B2B Videos"
          echo "Hook search complete!"
      
      - name: Combine all hooks
        run: |
          echo "Combining hooks..."
          python3 combine_hooks.py
          echo "Hooks combined!"
      
      - name: Prepare data for API
        run: |
          mkdir -p viralhookfinder4/data
          cp combined_hooks.json viralhookfinder4/data/latest_all.json
          echo "Last updated: $(date)" > viralhookfinder4/data/last_update.txt
          ls -la viralhookfinder4/data/
          echo "Data prepared!"
      
      - name: Commit and push updates
        run: |
          git config --global user.name 'Hook Finder Bot'
          git config --global user.email 'bot@viralhookfinder.com'
          git add viralhookfinder4/data/
          git add hook_database/
          git diff --staged --quiet || git commit -m "Auto-update hooks - $(date +'%Y-%m-%d')"
          git push || echo "No changes to push"
